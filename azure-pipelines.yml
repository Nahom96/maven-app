trigger:
  - main

stages:
  - stage: Build
    displayName: 'Build Stage'
    jobs:
      - job: BuildJob
        pool:
          name: Default  # Your self-hosted agent pool name
        steps:
          - task: Maven@3
            inputs:
              mavenPomFile: 'pom.xml'
              goals: 'package'
              options: '-Dmaven.test.skip=true'
              mavenVersionOption: 'Default'
              javaHomeOption: 'JDKVersion'
              jdkVersionOption: '1.11'
              jdkArchitectureOption: 'x64'

          - task: PublishBuildArtifacts@1
            inputs:
              PathtoPublish: 'target/jenkins-webapp.war'
              ArtifactName: 'drop'
              publishLocation: 'Container'

  - stage: Deploy
    displayName: 'Deploy to LocalAgent'
    dependsOn: Build
    jobs:
      - deployment: DeployJob
        displayName: 'Deploy WAR to Local Machine'
        environment: LocalAgent  # Must match exactly with your created environment
        strategy:
          runOnce:
            deploy:
              steps:
                - download: current
                  artifact: drop

                - task: CopyFiles@2
                  inputs:
                    SourceFolder: '$(Pipeline.Workspace)/drop'
                    Contents: '**/*.war'
                    TargetFolder: '/Users/nahom/Desktop/DeployedApps'

                - script: echo "âœ… WAR file deployed to local folder!"
                  displayName: 'Deployment Confirmation'
